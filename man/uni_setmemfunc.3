.TH "UNICORN" "3" "Jan 14th 2026" "Unicorn 1.3.2"
.SH NAME
uni_setmemfunc \- register a memory allocator
.SH LIBRARY
Embeddable Unicode Algorithms (libunicorn, -lunicorn)
.SH SYNOPSIS
.nf
.B #include <unicorn.h>
.PP
.BI "unistat uni_setmemfunc(void *" user_data ", unimemfunc " allocf ");"
.fi
.SH DESCRIPTION
Sets \f[I]allocf\f[R] as the implementation for dynamic memory allocations.
If \f[I]allocf\f[R] is null then the implementation reverts to its default allocator which may be the C standard allocator or a dummy allocator that always fails to allocate memory.
The latter is only present when the C standard library allocators are disabled.
.PP
Support for C standard library allocators must be enabled in the JSON configuration file.
If the standard allocators are not enabled, then dummy allocators that always return NULL are used.
In this case, a custom allocator must be supplied.
.PP
.in +4n
.EX
{
    "hasStandardAllocators": true
}
.EE
.in
.SH RETURN VALUE
.TP
UNI_OK
If the memory allocator was modified.
.TP
UNI_FEATURE_DISABLED
If \f[I]allocf\f[R] is null and Unicorn was built without support for the C standard library memory allocator.
.SH EXAMPLES
This example registers a custom memory allocator with Unicorn.
In the example, the custom allocator wraps the C standard memory allocators, however, this is redundant because Unicorn already initializes with a custom allocator that wraps the C standard allocators.
They are wrapped here for example purposes only.
An actual implementation would implement and wrap its own custom memory allocator.
.PP
.in +4n
.EX
#include <unicorn.h>
#include <stdlib.h>

static void *allocfree(void *ud, void *ptr, size_t osize, size_t nsize)
{
    if (nsize == 0)
    {
        free(ptr);
        return NULL;
    }
    else
    {
        return realloc(ptr, nsize);
    }
}

int main(void)
{
    uni_setmemfunc(NULL, allocfree);
    return 0;
}
.EE
.in
.SH SEE ALSO
.BR unimemfunc (3)
.SH AUTHOR
.UR https://railgunlabs.com
Railgun Labs
.UE .
.SH INTERNET RESOURCES
The online documentation is published on the
.UR https://railgunlabs.com/unicorn
Railgun Labs website
.UE .
.SH LICENSING
Unicorn is distributed with its end-user license agreement (EULA).
Please review the agreement for information on terms & conditions for accessing or otherwise using Unicorn and for a DISCLAIMER OF ALL WARRANTIES.
